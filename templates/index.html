<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Drony ‚Äì Panel Sterowania</title>
  
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

  <style>
    /* --- BAZA --- */
    *{box-sizing:border-box}
    body{margin:0;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;display:flex;height:100vh;background:#2a2a2a;overflow:hidden;}
    
    /* --- SIDEBAR --- */
    #sidebar{width:280px;background:#ffffff;border-right:2px solid #1322E6;padding:15px;overflow-y:auto;box-shadow:2px 0 8px rgba(19,34,230,0.3); z-index: 2000;}
    #sidebar h3{margin:12px 0 8px;font-size:1rem;color:#1322E6;border-bottom:2px solid #1322E6;padding-bottom:4px;text-transform:uppercase;letter-spacing:0.5px;font-weight:600}
    
    .item{padding:8px 10px;border-radius:6px;cursor:pointer;margin-bottom:6px;border-left:4px solid transparent;transition:all 0.2s;color:#333; background: #f4f4f4;}
    .item:hover{background:rgba(19, 33, 230, 0.1);transform:translateX(4px)}
    .item.active{border-left-color:#1322E6;color:#1322E6;font-weight:bold}
    .item.inactive{border-left-color:#c62828;color:#c62828}
    .item.detected{border-left-color:#757575;color:#666}
    .item.selected{outline: 2px solid #1322E6; background: rgba(19, 34, 230, 0.1);}
    
    .sidebar-control { margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px; }
    .sidebar-control button { width: 100%; padding: 8px; margin-bottom: 5px; cursor: pointer; }
    .btn-action { float: right; cursor: pointer; font-size: 0.8em; }

    /* --- MAPA --- */
    #map{flex:1; z-index: 1;}

    /* --- HUD / ZEGARY (Nowe style) --- */
    #gauges-container {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      flex-direction: column; /* Ustawienie pionowe */
      gap: 15px;
      z-index: 1000;
      pointer-events: none; /* Klikanie "przez" zegary w mapƒô */
      /* display: none; -> Odkomentuj je≈õli chcesz ukryƒá domy≈õlnie, JS to poka≈ºe */
    }
    
    .gauge {
      width: 150px;
      height: 150px;
      background-color: rgba(0, 0, 0, 0.8);
      border-radius: 50%;
      border: 3px solid #555;
      position: relative;
      overflow: hidden; /* Ukrywa wszystko co wychodzi poza k√≥≈Çko */
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }

    /* --- SZTUCZNY HORYZONT --- */
    #attitude-indicator { background: #333; }
    
    /* Ruchome t≈Ço (Niebo/Ziemia) */
    #horizon-gradient {
      position: absolute;
      top: -50%; 
      left: -50%;
      width: 200%; /* Musi byƒá du≈ºe, ≈ºeby przy obrocie nie brak≈Ço t≈Ça */
      height: 200%;
      background: linear-gradient(to bottom, #3ebfff 50%, #8b4513 50%);
      transition: transform 0.1s linear; /* P≈Çynny ruch */
      z-index: 1;
    }

    /* Bia≈Ça kreska horyzontu (rusza siƒô z t≈Çem) */
    .horizon-line {
      position: absolute;
      top: 50%; left: 0; width: 100%; height: 2px;
      background: rgba(255,255,255,0.7);
    }

    /* ≈ª√≥≈Çty celownik (sta≈Çy) */
    #crosshair {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 40px; height: 2px; background: yellow;
      z-index: 10;
      box-shadow: 0 1px 2px black;
    }
    #crosshair::after {
      content: ''; position: absolute; top: -5px; left: 50%;
      width: 2px; height: 10px; background: yellow;
      transform: translateX(-50%);
    }

    /* Tekst wewnƒÖtrz zegara */
    .hud-text {
      position: absolute; bottom: 15%; width: 100%;
      text-align: center; font-family: monospace; font-size: 11px;
      color: #0f0; text-shadow: 1px 1px 0 #000; z-index: 20;
    }

    /* --- KOMPAS --- */
    #compass {
      background: rgba(20, 20, 20, 0.9);
      color: white; font-weight: bold;
    }
    .compass-rose { width: 100%; height: 100%; position: relative; }
    
    .compass-label { position: absolute; font-size: 12px; color: #aaa; }
    .label-n { top: 5px; left: 50%; transform: translateX(-50%); color: red; font-weight: 900; }
    .label-e { right: 8px; top: 50%; transform: translateY(-50%); }
    .label-s { bottom: 5px; left: 50%; transform: translateX(-50%); }
    .label-w { left: 8px; top: 50%; transform: translateY(-50%); }

    /* Ig≈Ça kompasu */
    .compass-needle {
      position: absolute;
      top: 50%; left: 50%;
      width: 4px; height: 45%;
      background: red;
      transform-origin: bottom center; /* Obr√≥t wok√≥≈Ç dolnej krawƒôdzi */
      transform: translate(-50%, -100%) rotate(0deg); /* Startowa pozycja */
      transition: transform 0.2s cubic-bezier(0.4, 0.0, 0.2, 1);
      z-index: 5;
      border: 1px solid rgba(0,0,0,0.3);
    }
    .compass-center-dot {
       position: absolute; top: 50%; left: 50%;
       width: 6px; height: 6px; background: white;
       border-radius: 50%; transform: translate(-50%, -50%);
       z-index: 6;
    }
  </style>
</head>
<body>

  <div id="sidebar">
    <h3>Aktywne</h3>
    <div id="active-list"><em>Brak</em></div>

    <h3>Nieaktywne</h3>
    <div id="inactive-list"><em>Brak</em></div>

    <h3>Wykryte</h3>
    <div id="detected-list"><em>Brak</em></div>

    <div class="sidebar-control">
      <button id="mission-btn">‚ûï Nowa misja</button>
      <div id="mission-info" style="font-size:0.8rem; color:#666; margin-bottom:5px; min-height:1rem;"></div>
      <button id="clear-mission-btn" style="background:#ddd;" disabled>üóëÔ∏è Usu≈Ñ misjƒô</button>
      <div class="control-group">
      <label>Typ misji:</label>
      <select id="mission-type-select">
        <option value="lawnmower">Lawnmower (Podzia≈Ç obszaru)</option>
        <option value="leader-follower">Leader-Follower (Formacja)</option>
      </select>
      <button id="generate-path-btn" style="background:#1322E6; color:white;">üõ´ Generuj trasƒô</button>
    </div>
  </div>

  <div id="map"></div>

  <div id="gauges-container">
    
    <div id="attitude-indicator" class="gauge">
      <div id="horizon-gradient">
        <div class="horizon-line"></div>
      </div>
      <div id="crosshair"></div>
      <div class="hud-text" id="hud-roll-pitch">R: 0¬∞ P: 0¬∞</div>
    </div>

    <div id="compass" class="gauge">
      <div class="compass-rose">
        <span class="compass-label label-n">N</span>
        <span class="compass-label label-e">E</span>
        <span class="compass-label label-s">S</span>
        <span class="compass-label label-w">W</span>
        <div class="compass-needle" id="compass-needle-el"></div>
        <div class="compass-center-dot"></div>
      </div>
      <div class="hud-text" id="hud-yaw" style="bottom: 10px;">HDG: 0¬∞</div>
    </div>

  </div>

  <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>